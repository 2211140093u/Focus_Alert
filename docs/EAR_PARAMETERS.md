# EARパラメータの詳細説明

## `--ear-threshold-ratio`（EAR閾値比率）

### 数値範囲
- **推奨範囲**: `0.70` ～ `0.98`
- **デフォルト**: `0.90`
- **実用的な範囲**: `0.80` ～ `0.95`

### 意味
EAR基準値の何%未満で「閉眼」と判定するかを指定します。

- **計算式**: `閾値 = EAR基準値 × ear_threshold_ratio`
- **例**: 基準値が0.45の場合、`0.90`なら閾値は`0.405`（0.45 × 0.90）

### 値の変化による効果

#### 低い値（0.70-0.85）: より敏感に検出
- **効果**: 小さな目の動きでも閉眼と判定される
- **メリット**: まばたきを見逃しにくい
- **デメリット**: 誤検出が増える可能性（半開きの目を閉眼と誤判定）
- **使用例**: 
  - まばたきが検出されない場合
  - 目が小さい人
  - 検出感度を上げたい場合

#### 標準値（0.85-0.95）: バランス型
- **効果**: 通常のまばたきを適切に検出
- **メリット**: 誤検出と見逃しのバランスが良い
- **デメリット**: 個人差によっては調整が必要
- **使用例**: 
  - 通常の使用
  - デフォルト設定

#### 高い値（0.95-0.98）: より厳格に検出
- **効果**: 完全に閉じた時のみ閉眼と判定
- **メリット**: 誤検出が少ない
- **デメリット**: 小さなまばたきを見逃す可能性
- **使用例**: 
  - 誤検出が多い場合
  - 目が大きい人
  - 厳格な判定が必要な場合

### 調整の目安

1. **まばたきが検出されない場合**
   ```bash
   # 閾値を下げる（より敏感に）
   python src/app.py --ear-threshold-ratio 0.80 --width 1280 --height 720
   ```

2. **誤検出が多い場合**
   ```bash
   # 閾値を上げる（より厳格に）
   python src/app.py --ear-threshold-ratio 0.95 --width 1280 --height 720
   ```

3. **画面表示で確認**
   - `EAR`: 現在のEAR値
   - `ear_thr`: 閾値（この値未満で閉眼と判定）
   - `Blinks`: まばたき回数が増えているか確認

---

## `--ear-baseline-init`（EAR基準値の初期値）

### 数値範囲
- **推奨範囲**: `0.30` ～ `0.60`
- **デフォルト**: `0.45`
- **実用的な範囲**: `0.35` ～ `0.55`

### 意味
開眼時のEAR値の初期基準値です。この値はセッション中に適応的に更新されます。

- **個人差**: 目が大きい人は高い値（0.50-0.55）、目が小さい人は低い値（0.35-0.40）
- **適応的更新**: セッション中に開眼時のEAR値が自動的に更新される

### 値の変化による効果

#### 低い値（0.30-0.40）: 目が小さい人向け
- **効果**: 基準値が低く設定される
- **メリット**: 目が小さい人でも適切に検出される
- **デメリット**: 目が大きい人では感度が低くなる可能性
- **使用例**: 
  - 目が小さい人
  - アジア系の目
  - 初期値でまばたきが検出されない場合

#### 標準値（0.40-0.50）: 一般的な目
- **効果**: 平均的な目に適した基準値
- **メリット**: 多くの人に適用可能
- **デメリット**: 個人差によっては調整が必要
- **使用例**: 
  - 通常の使用
  - デフォルト設定

#### 高い値（0.50-0.60）: 目が大きい人向け
- **効果**: 基準値が高く設定される
- **メリット**: 目が大きい人でも適切に検出される
- **デメリット**: 目が小さい人では誤検出が増える可能性
- **使用例**: 
  - 目が大きい人
  - 欧米系の目
  - 初期値で誤検出が多い場合

### 調整の目安

1. **画面表示でEAR値を確認**
   - 開眼時のEAR値が`0.40`未満 → `--ear-baseline-init 0.35`を試す
   - 開眼時のEAR値が`0.50`以上 → `--ear-baseline-init 0.50`を試す

2. **個人差に対応**
   ```bash
   # 目が小さい人
   python src/app.py --ear-baseline-init 0.35 --ear-threshold-ratio 0.85
   
   # 目が大きい人
   python src/app.py --ear-baseline-init 0.50 --ear-threshold-ratio 0.90
   ```

3. **組み合わせ調整**
   - 基準値が低い → 閾値比率も少し下げる（0.85程度）
   - 基準値が高い → 閾値比率は標準（0.90程度）

---

## パラメータの組み合わせ例

### パターン1: 敏感に検出したい
```bash
python src/app.py --ear-threshold-ratio 0.80 --ear-baseline-init 0.40
```
- 小さなまばたきも検出
- 誤検出の可能性あり

### パターン2: 厳格に検出したい
```bash
python src/app.py --ear-threshold-ratio 0.95 --ear-baseline-init 0.50
```
- 完全に閉じた時のみ検出
- 見逃しの可能性あり

### パターン3: バランス型（推奨）
```bash
python src/app.py --ear-threshold-ratio 0.90 --ear-baseline-init 0.45
```
- 標準的な設定
- 多くの人に適用可能

---

## トラブルシューティング

### まばたきが全く検出されない

1. **EAR値を確認**
   - 画面表示で`EAR`と`ear_thr`を確認
   - EAR値が閾値を下回っているか確認

2. **閾値を下げる**
   ```bash
   python src/app.py --ear-threshold-ratio 0.75 --width 1280 --height 720
   ```

3. **基準値を調整**
   ```bash
   python src/app.py --ear-baseline-init 0.40 --ear-threshold-ratio 0.85
   ```

### 誤検出が多い

1. **閾値を上げる**
   ```bash
   python src/app.py --ear-threshold-ratio 0.95
   ```

2. **基準値を上げる**
   ```bash
   python src/app.py --ear-baseline-init 0.50 --ear-threshold-ratio 0.92
   ```

### 個人差に対応

1. **画面表示で開眼時のEAR値を確認**
2. **その値に近い初期値を設定**
3. **閾値比率は0.85-0.90の範囲で調整**

