# GUI操作ガイド

## 概要

Raspberry Pi 5用のGUI版アプリケーションです。3.5インチタッチモニタ（320×480）で操作できます。

## 起動方法

### デスクトップショートカットから

デスクトップの「Focus Alert」アイコンをダブルクリック

### ターミナルから

```bash
./scripts/start_focus_alert.sh
```

または

```bash
python src/app_gui.py --backend zmq --width 1280 --height 720 --display-width 320 --display-height 480
```

## メインメニュー

アプリを起動すると、以下の3つのオプションが表示されます：

### 1. 計測開始

- **機能**: 集中力の計測を開始します
- **操作**: 「計測開始」ボタンをタッチ
- **動作**: 
  - カメラからの映像を表示
  - まばたき・視線を検出
  - リスクスコアを計算
  - CSVログを自動保存（`logs/session_YYYYMMDD_HHMMSS.csv`）

### 2. データ確認

- **機能**: 過去の計測データを確認・管理します
- **操作**: 「データ確認」ボタンをタッチ
- **機能**:
  - ログファイル一覧の表示
  - レポートの生成・表示
  - メモの編集（実装予定）
  - データの削除（実装予定）

### 3. オプション

- **機能**: 各種設定を変更します
- **操作**: 「オプション」ボタンをタッチ
- **設定項目**:
  - **EAR閾値比率**: まばたき検出の感度（0.70-0.98、デフォルト0.90）
  - **EAR基準値**: 開眼時の基準値（0.30-0.60、デフォルト0.45）
  - **リスク閾値**: アラート発火の閾値（0.40-0.70、デフォルト0.55）
  - **クールダウン**: アラート間隔（30-120秒、デフォルト60秒）

## オプション画面の操作

### パラメータの調整

1. **値の表示**: 各パラメータの現在値が表示されます
2. **+ボタン**: 値を増やす（タッチ）
3. **-ボタン**: 値を減らす（タッチ）
4. **保存**: 設定を保存してメインメニューに戻る
5. **戻る**: 設定を保存せずにメインメニューに戻る

### 設定の保存

- 設定は`config/settings.json`に保存されます
- 次回起動時に自動的に読み込まれます

## データ確認画面の操作

### ファイル一覧

- 最新のログファイルが上から順に表示されます
- 最大8個まで表示
- ファイル名をタッチすると詳細画面に遷移

### 詳細画面

- **戻る**: ファイル一覧に戻る
- **レポート**: レポートを生成・表示（実装予定）

## 計測中の操作

計測中は以下のボタンが使用できます：

- **Start**: ブロック開始
- **End**: ブロック終了
- **Mark**: マーカー（任意のタイミングを記録）
- **Dist**: 注意散漫トグル
- **Calib**: 視線キャリブレーション
- **Quit**: 計測終了（メインメニューに戻る）

## 設定ファイル

### 場所

`config/settings.json`

### 形式

```json
{
  "ear_threshold_ratio": 0.90,
  "ear_baseline_init": 0.45,
  "risk_threshold": 0.55,
  "cooldown_sec": 60.0
}
```

### 手動編集

設定ファイルを直接編集することも可能です。編集後、アプリを再起動すると反映されます。

## トラブルシューティング

### メニューが表示されない

- ウィンドウサイズを確認（320×480）
- フルスクリーンモードが有効か確認

### タッチが反応しない

- タッチスクリーンのキャリブレーションを確認
- マウスでクリックして動作確認

### 設定が保存されない

- `config/`ディレクトリの書き込み権限を確認
- 設定ファイルの形式を確認（JSON形式）

### 計測が開始しない

- カメラが接続されているか確認
- カメラプロキシが起動しているか確認（Raspberry Piの場合）

## 今後の実装予定

- [ ] メモ編集機能（仮想キーボード）
- [ ] データ削除機能
- [ ] レポート表示機能
- [ ] セッション情報の入力（GUI）

## 参考

- [PCセットアップガイド](PC_SETUP.md)
- [Raspberry Piセットアップガイド](RASPBERRY_PI_SETUP.md)
- [EARパラメータの詳細説明](EAR_PARAMETERS.md)
- [リスクスコアの判定方法](RISK_SCORE.md)

