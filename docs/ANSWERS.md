# 質問への回答まとめ

## Q1: `--ear-threshold-ratio`と`--ear-baseline-init`の数値範囲と効果

詳細は [EARパラメータの詳細説明](EAR_PARAMETERS.md) を参照してください。

### 概要

#### `--ear-threshold-ratio`（EAR閾値比率）
- **範囲**: 0.70 ～ 0.98（推奨: 0.80 ～ 0.95）
- **デフォルト**: 0.90
- **意味**: EAR基準値の何%未満で「閉眼」と判定するか
- **効果**:
  - **低い値（0.70-0.85）**: より敏感に検出（小さな目の動きでも閉眼と判定）
  - **標準値（0.85-0.95）**: バランス型（通常のまばたきを適切に検出）
  - **高い値（0.95-0.98）**: より厳格に検出（完全に閉じた時のみ閉眼と判定）

#### `--ear-baseline-init`（EAR基準値の初期値）
- **範囲**: 0.30 ～ 0.60（推奨: 0.35 ～ 0.55）
- **デフォルト**: 0.45
- **意味**: 開眼時のEAR値の初期基準値
- **効果**:
  - **低い値（0.30-0.40）**: 目が小さい人向け
  - **標準値（0.40-0.50）**: 一般的な目
  - **高い値（0.50-0.60）**: 目が大きい人向け

詳細は [EAR_PARAMETERS.md](EAR_PARAMETERS.md) を参照してください。

---

## Q2: PCで映像がモノクロになっている理由

詳細は [モノクロ表示の問題](MONOCHROME_ISSUE.md) を参照してください。

### 考えられる原因

1. **カメラの設定問題**: カメラがモノクロモードになっている
2. **OpenCVの表示問題**: フレーム形式の解釈の問題
3. **カメラドライバーの問題**: RGB変換が無効になっている
4. **カメラのハードウェア問題**: カメラ自体がモノクロモード

### 対処法

1. **カメラアプリで確認**: 他のアプリでカラー表示されるか確認
2. **コードで明示的に設定**: `CAP_PROP_CONVERT_RGB`を1に設定（既に実装済み）
3. **カメラドライバーの更新**: 最新のドライバーに更新

詳細は [MONOCHROME_ISSUE.md](MONOCHROME_ISSUE.md) を参照してください。

---

## Q3: リスクスコアはどのように判定しているか

詳細は [リスクスコアの判定方法](RISK_SCORE.md) を参照してください。

### 計算式

```python
# 各指標の重み付け
long_close = 1.0 if 長時間閉眼 else 0.0        # 重み: 0.7 (70%)
off_lvl = 視線逸脱レベル (0.0-1.0)              # 重み: 0.2 (20%)
closed_now = 1.0 if 現在閉眼 else 0.0          # 重み: 0.1 (10%)

# 生スコアの計算
raw_score = 0.7 × long_close + 0.2 × off_lvl + 0.1 × closed_now

# 指数移動平均で平滑化（α = 0.3）
risk_score = 0.3 × raw_score + 0.7 × 前回のrisk_score
```

### アラート判定

- **閾値**: 0.55（55%）
- **クールダウン**: 前回のアラートから60秒以内は再発火しない
- **意味**: リスクスコアが55%以上で、かつ60秒以内にアラートが出ていない場合に発火

### リスクスコアの解釈

- **0.0 ～ 0.3**: 低リスク（集中している）
- **0.3 ～ 0.55**: 中リスク（注意が必要）
- **0.55 ～ 1.0**: 高リスク（アラート発火）

詳細は [RISK_SCORE.md](RISK_SCORE.md) を参照してください。

---

## Q4: Raspberry PiでGUIで設定変更できるようにしたい

**現在の状況**: コードベースでの設定変更が必要

**実装予定**: GUI設定画面と仮想キーボードの実装

### 実装予定の機能

1. **設定画面**: 
   - EAR閾値比率の調整
   - EAR基準値の調整
   - アラート閾値の調整
   - その他のパラメータ調整

2. **仮想キーボード**: 
   - 数値入力用
   - メモ入力用

3. **設定の保存**: 
   - 設定ファイルに保存
   - 次回起動時に自動読み込み

**注意**: これは大きな機能追加のため、段階的に実装する必要があります。

---

## Q5: 計測データの命名とメモ機能

### 現在の実装

1. **自動データ命名**: 実装済み
   - 日時ベースのファイル名: `session_YYYYMMDD_HHMMSS.csv`
   - 例: `session_20240115_143022.csv`

2. **日時の記録**: 実装済み
   - メタデータに開始日時を記録
   - ISO形式とタイムスタンプの両方を記録

3. **メモ機能**: 基本実装済み
   - `logger.write_note()`メソッドでメモを記録可能
   - イベントとして記録

### 使用方法

```python
# 自動命名でログを開始
python src/app.py --log logs  # ディレクトリのみ指定

# メモを記録（コード内）
logger.write_note("作業開始: タイピング練習")
```

### 今後の改善予定

1. **GUIでのメモ入力**: 仮想キーボードを使用
2. **メモの表示**: レポートにメモを表示
3. **セッション情報の入力**: GUIでセッション名、参加者名などを入力

---

## まとめ

- **Q1**: [EAR_PARAMETERS.md](EAR_PARAMETERS.md) を参照
- **Q2**: [MONOCHROME_ISSUE.md](MONOCHROME_ISSUE.md) を参照（修正済み）
- **Q3**: [RISK_SCORE.md](RISK_SCORE.md) を参照
- **Q4**: GUI設定機能は実装予定（段階的に実装）
- **Q5**: 自動データ命名とメモ機能は実装済み（GUI入力は実装予定）

